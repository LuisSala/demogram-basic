/* ===========================================================================
   BPM Combined Asset File
   MANIFEST: demogram ()
   This file is generated automatically by the bpm (http://www.bpmjs.org)    
   =========================================================================*/
spade.require("sproutcore"),spade.require("sproutcore-touch");var App=SC.Application.create({store:SC.Store.create({commitRecordsAutomatically:YES}).from("App.MediaDataSource")});App.INSTAGRAM_CLIENT_ID="74cd2b3572294d88917c0e180a5c2526",App.INSTAGRAM_API_VERSION="v1",App.User=SC.Record.extend({primaryKey:"id",username:SC.Record.attr(String)}),App.Image=SC.Record.extend({url:SC.Record.attr(String)}),App.ImageCollection=SC.Record.extend({standard_resolution:SC.Record.toOne("App.Image",{nested:!0})}),App.MediaRecord=SC.Record.extend({primaryKey:"id",user:SC.Record.toOne("App.User",{nested:!0}),images:SC.Record.toOne("App.ImageCollection",{nested:!0}),createDateTime:function(){return SC.DateTime.create(this.get("create_time"))}.property("create_time").cacheable()}),App.POPULAR_QUERY=SC.Query.remote(App.MediaRecord,{query:{endpoint:"media",media_id:"popular"}}),App.MediaDataSource=SC.DataSource.extend({fetch:function(a,b){var c=App.INSTAGRAM_API_VERSION,d="client_id="+App.INSTAGRAM_CLIENT_ID,e=b.query,f=e.endpoint,g=e.media_id,h="callback=?",i="https://api.instagram.com/"+c+"/"+f+"/"+g+"?"+d+"&"+h;SC.Logger.log("fetch() - Fetching content at: "+i);var j=this;$.ajax({url:i,dataType:"jsonp",success:function(c){SC.run(function(){j.didFetchMedia(c,a,b)})},error:function(){SC.run(function(){a.dataSourceDidErrorQuery(b)})}});return YES},didFetchMedia:function(a,b,c){SC.Logger.log("didFetchMedia called");var d=a.meta.code;SC.Logger.log("didFetchMedia: code = "+d);var e=a.data,f=b.loadRecords(App.MediaRecord,e);b.loadQueryResults(c,f),b.dataSourceDidFetchQuery(c)}}),App.mediaController=SC.ArrayProxy.create({content:[],comments:[],loadPopular:function(){this.set("content",App.store.find(App.POPULAR_QUERY))},openDetails:function(a){SC.Logger.log("Opening: "+a.get("id"));var b=App.MediaDetailsView.create({content:a});this.set("comments",a.getPath("comments.data")),b.append(),this.set("detailsView",b)},closeDetails:function(){var a=this.get("detailsView");a.destroy()}}),App.MainView=SC.View.extend({init:function(){this._super(),SC.Logger.log("Initializing MainView"),App.mediaController.loadPopular()}}),App.MediaItemView=SC.View.extend({click:function(a){return this.tapEnd()},tapEnd:function(){SC.Logger.log("Tap/Click Detected: "+this.getPath("content.id")),App.mediaController.openDetails(this.get("content"));return!0}}),App.MediaDetailsView=SC.View.extend({templateName:"photo-details",classNames:["photo-details"]}),App.CloseDetailsButton=SC.View.extend({classNames:["app-button"],tapEnd:function(){App.mediaController.closeDetails()}}),App.PinchableView=SC.View.extend({pinchChange:function(a,b){this.$().css("-webkit-transform","scale3d("+b+","+b+", 1010)")}})